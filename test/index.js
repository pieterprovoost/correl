import { cor, lm } from "../src/index.js";
import { assert } from "chai";

const x = [ 3.2239837722788, 4.63600801983748, 4.68527898353459, 3.57190708708921, 0.979113703779129, 3.05609731432767, 3.95943938284642, 3.75733700260193, 2.89386806275033, 3.41850964321514, 3.02469960890134, 3.01566443839206, 2.15172602103969, 2.40469636520247, 2.53533423011558, 2.48161137968168, 1.47126318096214, 2.5113477304704, 2.29709475171281, 3.12989357334528, 3.8721581847412, 4.09834905517959, 3.78264289479589, 3.76851779590246, 2.46903560911149, 2.85991665896559, 3.97315177310521, 3.71704521796714, 1.78880412185802, 3.27181331731097, 4.7091817157689, 3.61853760433567, 2.81064612399663, 2.21886858438752, 3.04179545827101, 2.26070584939121, 4.48788541796879, 2.57908106578923, 2.67416795079807, 2.42752545330985, 1.62776324919026, 2.48906298182342, 3.71723522399757, 3.64239360669886, 3.59511265126379, 3.9787570840483, 2.35262222444833, 4.04285629849497, 4.61745561184642, 3.79940670912519, 2.00919422755409, 3.10008490736068, 3.56429892823387, 2.54014489052284, 2.90286655389975, 3.31363882768098, 2.69228912596327, 1.84107743207671, 1.76018136967902, 1.30083331356081, 2.0548996713582, 2.55881260521417, 1.02490638552824, 0.922066888558511, 2.13674064316432, 2.82337826782912, 3.90737030275469, 2.06910845183058, 3.31474413328133, 2.59108019395247, 3.98368224907306, 1.84691860937216, 0.688571617434501, 1.67463035228061, 2.36155555058383, 3.31613904032563, 0.597488868049282, 2.94553254305307, 2.12883234913317, 1.31980885894822, 3.058776199792, 6.16023024508416, 2.91234369482292, 2.94280645623554, 4.4612367241394, 4.05926860046102, 1.87845751718842, 5.49580416809397, 3.0294095338974, 3.08056768460979, 3.04676639798673, 2.89782441527575, 3.18402760381388, 2.41739953007011, 2.81222190744804, 3.12957989047758, 2.79428871406345, 1.66283555227389, 2.36648761199604, 1.4118073409285, 3.04194715755348, 2.72007915886531, 2.56180897967594, 3.63853423217004, 2.78801940747113, 0.864404889964635, 4.0056253123599, 1.98804933818645, 2.88222764192804, 3.89453138614814, 4.32070464081242, 3.97590728892775, 4.97440953492692, 4.28898222275903, 2.39059493141064, 3.92217323095538, 1.27654127740675, 3.41839954428871, 3.57934806575455, 3.22423270568902, 4.21505269787066, 3.41159522509831, 2.8516185040304, 2.7461006989672, 2.52573760243166, 3.13577127845656, 2.3995803283306, 2.7975220884306, 4.38479883208256, 2.34375909146313, 2.95843101172914, 3.24979818548564, 3.05288570176778, 2.34667794208427, 1.20048928764668, 2.79985798364812, 3.37190227297105, 1.32129440265325, 3.66558170059202, 3.65816872011383, 1.73273737264021, 4.44977868213856, 1.60095885679724, 3.24038987519447, 2.70853243886906, 3.44626245694536, 2.10720477806662, 1.69494986197171, 3.31745286689255, 2.85035428402554, 4.19987291242726, 3.6423592304667, 4.19137084518543, 2.70620379583877, 3.39788364713225, 3.50584534636307, 3.56475111112014, 2.02265115859543, 3.38024358367974, 1.35676181218422, 4.62354883976655, 3.19838315049237, 1.07270795726317, 4.04566129841994, 3.90557859779222, 3.49054659816516, 2.70029912046419, 3.20746024092322, 4.22416645730016, 1.17746672154239, 2.79634550166461, 2.20258313675053, 5.9011962963844, 1.78190146867136, 1.44494559718843, 3.70920635578343, 3.24678516037512, 1.58776537510125, 2.87342239885388, 1.5279700707429, 2.47206160555282, 3.87469256434844, 2.82945654845218, 4.02875010196398, 4.59369543357415, 2.91057116913816, 3.16792517521375, 3.42411044001814, 2.33307605424441, 2.16531319840577, 3.33877013611739, 3.26861113824341, 2.47615105050503, 3.10571123649223, 1.98676186447484, 2.393195462501, 1.57176930157819, 2.9016446409187, 4.00950376615512, 3.03226141136949, 2.64869324132761, 2.97088570126318, 2.87688781735954, 2.16047616741747, 3.59951397202333, 4.79305927778062, 1.30501829634327, 2.43889555597767, 1.75830240034983, 3.78323547201764, 3.21486521120885, 5.22517583842901, 3.18220887735281, 2.26602184254074, 4.4705395755856, 3.86793571040617, 1.83761826229498, 2.75125232281803, 3.25572336459465, 2.62171600566469, 3.78065207714351, 2.13040779520622, 5.43576223567245, 4.57432327548595, 2.41940541233632, 1.89037939099115, 4.67570923316418, 2.78641874813844, 3.12984182532555, 3.15737430774018, 3.924371827223, 3.79248371348174, 3.00976644662261, 2.2328074234505, 5.49780786380338, 3.96605127682217, 1.26623004033668, 4.26463202271053, 5.3323713237078, 3.17712734359125, 2.78234065501582, 3.38840911325457, 3.52547778925504, 2.31373100673246, 3.64251620685421, 2.20744996699495, 2.43888529003757, 2.02600761330941, 2.52837343025994, 2.79834953484437, 2.12989964737289, 5.5463666626337, 2.59040980485315, 4.31950089293621, 2.65622615052703, 1.68089326760383, 3.36864240127784, 4.10734347298406, 2.6744066279309, 1.84839500686532, 2.7994459603491, 3.08458478967778, 3.49357691651654, 3.08493765171623, 3.23661310954569, 4.29246170557395, 2.18827466190132, 3.06261860442556, 4.32808799335611, 2.75734031963166, 3.05196436737061, 4.42488338132242, 1.01202275511747, 3.86409351722004, 4.14111597914588, 2.67817753491994, 1.68098678433015, 3.41452969746791, 2.78717043679988, 4.0192954309871, 1.48877633711541, 2.61648300590587, 2.73722853653661, 2.558446737643, 2.48904935050431, 4.05933272435118, 2.21264683176087, 3.68366421448045, 0.888844940463707, 2.2515405257937, 2.5465665413651, 3.69938178008715, 3.22737344251329, 4.21663140438805, 2.57563878648138, 2.35149275009835, 3.12458413145364, 3.50814695792595, 4.59334726060143, 2.22100035045668 ];
const y = [ -1.38613899595004, 2.13922506424018, 1.89388960588653, 0.135473051574355, -0.0727552679407553, -0.859966876932536, 0.585767517663067, -0.97881241950914, 0.209951917963625, 1.11992601912394, 1.89403430390583, 0.183588834337467, 1.04229385311984, 1.38599800262045, 2.85961610156794, 0.132966318985023, -0.354754320293446, -0.778490957516181, 1.71167013171211, 0.940527666747385, 1.66441742714407, 0.693070544451745, 1.29241738042686, 1.12226912742068, 1.13858998451155, 0.41141312821355, 2.14780957076927, 0.487319865487425, 1.91170389226143, 1.14600631292213, 2.55325870351643, 1.64542369188366, 0.711292929906623, 1.14780329547197, 0.888925103026256, -0.986373041212992, 2.50499351449618, 2.1828476550284, 0.296272154479643, 1.51193647574963, 1.50501343446609, -0.0463144502941704, 2.42426852106716, 0.660995758628976, 1.11028890094357, 1.2710425935742, 0.118583768983837, -0.262645056356573, 0.698947318631303, 1.47653998667176, 1.26830903140339, 1.72835998409367, 1.27023281819525, 1.65969119779027, -0.392838666005036, 1.66245952449704, 0.269496280254333, 0.745633732534075, 1.12815347445281, -0.37021066019522, 1.08337852606049, 0.649800984562671, 0.626380400441348, 0.811384220826803, 2.44376579731038, -0.232176254521695, 0.649435016753271, -1.34315268623279, 0.281610094727068, 0.581526056984459, 2.43243910060755, 0.237537278734977, 0.526659789164982, -0.178214912598706, 1.31656698137188, 2.1494645201745, 0.208711852643531, 0.598363606677051, 2.56856461138861, 0.611102618256189, 1.71451847891218, 0.883721974209411, -0.29481876857558, 2.27722658502659, 1.58765741509786, 0.344797157559256, 0.291453304596216, 0.199994853254247, 1.8508729900784, 0.433817297771562, -0.898919499029372, 0.895472020272602, 1.78145559406917, -0.0610392059755556, 0.812973845246761, -0.246810132287863, 1.17847855630424, 1.11648663464639, 1.09758573175792, 0.658751575527102, 0.292120724362262, 1.96220017476961, 1.20615954948414, 0.724300796065838, -2.22299590618666, 0.0844776905724958, 1.63230104971723, 0.780794020404314, -0.190495341065125, 0.422805229931465, 0.415336356646672, 0.345469593574337, 1.19517144963747, 2.35851858395439, 2.13751616539845, 2.14026090869761, 0.98062506558776, 1.81554876807463, -0.0770584584746903, 0.843631260117708, 3.05014772199912, 0.940860695321809, 0.737400915725, 0.470395300965676, 1.89294727107003, 3.15303042573426, 1.54750330236854, 0.7916199466181, 2.90714435053422, 0.34007829637161, 2.18734984647809, 0.551006021317001, -0.0289322243518257, 2.3802265269721, -0.508335962859106, 0.74321333915713, 0.976583212907677, 0.858101030121859, -0.762992516814168, 0.256589078826502, -0.350992530286905, 2.74217348181093, -0.634869027367172, -1.16886925577088, 1.78658393236874, 1.87527665669477, 0.975915699042735, 1.03507587315293, 1.71084457554624, 2.47876833647123, -0.805523711204675, 2.24757408651019, 1.02141389876009, 0.727396604643578, 2.24901071069178, 1.89816019850683, 2.23367189158071, 0.893074205411253, 1.75239123868237, 1.60618154734286, 0.219042101283693, 2.78580562061971, 1.51765256447655, 0.790078005933338, 1.41031295950974, 1.33874398130806, 0.353991460422005, 0.934405956020924, 3.47877386211458, 1.26038184908221, 0.756050699786653, 1.91025438082808, 0.940087070652813, 0.681561223447721, 0.182679757277956, 1.7695412424016, 1.10347809325479, 1.7574147978445, 0.747975359405271, -0.413255840452794, 1.18461952827582, 3.31773673196187, -0.440481361479895, -0.157426813697045, -0.612566166184992, 0.666232219550002, 2.40702865566315, 0.795178740028319, 0.87655654338673, -0.150426468099507, 1.03306239858417, 2.03620798549163, 3.42278013293032, 2.34941455497801, 0.307713626715387, 0.613363339641065, 1.88807589902804, 1.03057910911098, 1.13344193336516, -0.322300239754748, 0.648107766876093, 0.0824569214253894, 0.0962690534090614, 0.432536168214895, 0.498128588418562, 0.712841614216443, 1.96007713017085, 0.59939567604148, 0.359930424356917, 2.54203612941398, 2.00300044467177, 1.35704849624367, 2.73005106414912, 0.150075754680179, 2.86702826383897, 2.12939856680881, 1.53581018567935, 1.70439370879205, 1.04319909913237, 0.975285440098831, -0.719474994550289, 1.93098904843526, 2.79814358215635, 2.89119613505793, 1.29648320351739, 1.10288233628684, 0.924583256454597, 2.23136177359919, 2.51144888837513, 1.4141069020207, 2.00517020818342, 0.861417333398956, 1.53098616633519, 2.36624758252713, 4.31744350444328, 0.804336367359924, 0.636731803629318, 1.26417202663422, 0.212093484617627, 1.64303376185322, 1.40984584565117, 2.30275933388142, -0.0461182478315028, -0.0908484695169087, 2.51635473498763, 1.38929065857598, 0.177164860150438, 0.092840065404909, 0.540034756701563, 1.66176109010925, 0.633544903382772, 1.96138535753507, 1.34301583119793, 0.999452889492976, 1.06678898058052, 0.944736361642582, 0.789953050987471, 2.01711983522494, -0.288380756022718, 2.33070775315649, 0.699924791441397, 1.76040508786552, 0.880315321896085, -0.365518007549397, 1.33823972778955, 0.151597780328984, 2.31125181959926, 0.167650917312235, -1.0288871667491, 0.192806243828857, 0.430747135170459, -0.0625720180215845, 1.11998005783148, 0.268587822810858, 0.410002166768386, 1.41404446472852, 0.0597828473252704, 1.73020728085672, 1.05772868283044, 0.811384615351071, -0.799074902229316, 0.781625452931829, 0.501096420162996, 1.96505845012961, 2.53224684004653, 2.10169509604773, 0.020618676710904, 0.0942238484500525, 1.29225361064607, 0.0688431238326778, -0.537936391957302, 1.71353429389417, 1.05499212553238, 1.44460995253959, -0.132902901935383, 0.78668674431135, -0.193904515265231, 0.090035887880156, 0.986860019640455, 0.324039955525605 ];

describe("cor", () => {
  it("should correctly calculate Pearson correlation", () => {
    const result = cor(x, y);
    assert.closeTo(result.r, 0.2, 0.000001);
    assert.closeTo(result.t, 3.5237, 0.0001);
    assert.equal(result.df, 298);
    assert.closeTo(result.p, 0.0004923, 0.000001);
  });
});

describe("lm", () => {
  it("should return the expected model", () => {
    const result = lm(x, y);
    assert.closeTo(result.slope, 0.2, 0.000001);
    assert.closeTo(result.intercept, 0.4, 0.000001);
    assert.closeTo(result.df, 298, 0.000001);
    assert.closeTo(result.rs, 0.04, 0.01);
    assert.closeTo(result.rse, 0.9814, 0.0001);
    assert.closeTo(result.slope_se, 0.05676, 0.00001);
    assert.closeTo(result.slope_t, 3.524, 0.001);
    assert.closeTo(result.slope_p, 0.000492, 0.000001);
    assert.closeTo(result.intercept_se, 0.17945, 0.00001);
    assert.closeTo(result.intercept_t, 2.229, 0.001);
    assert.closeTo(result.intercept_p, 0.026561, 0.000001);
  });
});
